---
title: "workflow_dispatch の入力値を Job Summary に表示する GitHub Action を作った"
emoji: "📋"
type: "tech"
topics: ["githubactions", "typescript", "cicd"]
published: true
---

## はじめに

GitHub Actions の `workflow_dispatch` イベントを使うと、Workflow を手動で実行できます。デプロイ先の環境やバージョン番号などをパラメータとして受け取れるため、運用系の Workflow では非常に便利な機能です。

しかし、実行後に Job Summary を見ても「どの入力値で実行したか」がすぐにわかりません。過去の実行履歴を確認する際に、どの設定で実行されたのかを把握しづらいという課題がありました。

この課題を解決するため、入力値を Job Summary にテーブル形式で表示する GitHub Action「**display-inputs-action**」を作成しました。本記事では、この Action の使い方と仕組みを紹介します。

## workflow_dispatch の課題

`workflow_dispatch` は、Workflow に入力パラメータを定義できます。以下のような定義が可能です。

```yaml
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'デプロイ先環境'
        required: true
        type: choice
        options:
          - development
          - staging
          - production
      version:
        description: 'バージョン番号'
        required: true
        type: string
      debug:
        description: 'デバッグモード'
        required: false
        type: boolean
        default: false
```

この定義により、Workflow 実行時に環境やバージョンを指定できます。

しかし、Workflow 実行後の Job Summary には、これらの入力値が表示されません。後から「この Workflow はどの環境にデプロイしたのか」「どのバージョンを指定したのか」を確認するには、Workflow の実行詳細画面まで遷移する必要があります。

特にチームで運用している場合、他のメンバーが実行した Workflow の設定を素早く確認したいケースは多いでしょう。

## display-inputs-action の紹介

この課題を解決するために、**display-inputs-action** を開発しました。

https://github.com/VeyronSakai/display-inputs-action

この Action は、`workflow_dispatch` の入力値を Job Summary にテーブル形式で表示します。

![Job Summary に表示される入力値のテーブル](/images/af055218793dd5/job-summary.png)
*Job Summary に入力値がテーブル形式で表示される*

GitHub Marketplace でも公開しています。

https://github.com/marketplace/actions/display-inputs-action

## 特徴

display-inputs-action には、以下の特徴があります。

### actions/checkout が不要

多くの Action はリポジトリのチェックアウトを前提としていますが、display-inputs-action は **`actions/checkout` なしで動作します**。

GitHub API を使って Workflow ファイルを直接取得するため、余分なステップを追加する必要がありません。

### わかりやすいテーブル形式

入力値は以下の 3 列のテーブルで表示されます。

| Input Name | Description | Value |
| --- | --- | --- |
| environment | デプロイ先環境 | production |
| version | バージョン番号 | 1.2.3 |
| debug | デバッグモード | true |

入力名だけでなく、Workflow で定義した説明（description）も一緒に表示されるため、各パラメータの意味がすぐにわかります。

### シンプルな設定

設定は 1 ステップ追加するだけです。複雑な設定は必要ありません。

## 使い方

display-inputs-action の使い方を紹介します。

### 基本的な使い方

Workflow に以下のステップを追加するだけで利用できます。

```yaml
name: Deploy Application

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'デプロイ先環境'
        required: true
        type: choice
        options:
          - development
          - staging
          - production
      version:
        description: 'バージョン番号'
        required: true
        type: string
      debug:
        description: 'デバッグモード'
        required: false
        type: boolean
        default: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 入力値を Job Summary に表示
      - name: Display workflow inputs
        uses: VeyronSakai/display-inputs-action@v0.1

      # 以降は通常のデプロイ処理
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy
        run: echo "Deploying ${{ inputs.version }} to ${{ inputs.environment }}"
```

:::message
`display-inputs-action` は `actions/checkout` より前に配置できます。リポジトリのチェックアウトに依存しないためです。
:::

### 出力例

Workflow を実行すると、Job Summary に以下のようなテーブルが表示されます。

| Input Name | Description | Value |
| --- | --- | --- |
| environment | デプロイ先環境 | production |
| version | バージョン番号 | 1.2.3 |
| debug | デバッグモード | true |

これにより、Workflow の実行結果を見るだけで、どのパラメータで実行されたかを即座に把握できます。

## 仕組み

display-inputs-action の内部動作を簡単に説明します。

### 1. Workflowファイルの取得

GitHub API を使って、実行中の Workflow ファイル（YAML）を取得します。これにより、`actions/checkout` なしで Workflow の定義にアクセスできます。

### 2. 入力定義の解析

取得した Workflow ファイルから、`workflow_dispatch.inputs` セクションをパースします。各入力パラメータの名前と説明（description）を抽出します。

### 3. 実際の入力値とのマッピング

GitHub Actions の `github.event.inputs` コンテキストから、実際に渡された入力値を取得します。Workflow 定義の情報と組み合わせて、テーブルのデータを構築します。

### 4. Job Summary への出力

構築したテーブルを、GitHub Actions の Job Summary 機能を使って Markdown 形式で出力します。

## まとめ

display-inputs-action を使えば、`workflow_dispatch` の入力値を Job Summary に簡単に表示できます。

- **すぐに確認できる**: 実行結果画面で入力値がひと目でわかる
- **設定が簡単**: 1 ステップ追加するだけで導入可能
- **チーム運用に便利**: 他のメンバーが実行した Workflow の設定もすぐに把握できる

ぜひ試していただき、フィードバックをいただけると嬉しいです。Issue や Pull Request も歓迎します。

<https://github.com/VeyronSakai/display-inputs-action>

## 参考

- [display-inputs-action - GitHub](https://github.com/VeyronSakai/display-inputs-action)
- [Display Inputs Action - GitHub Marketplace](https://github.com/marketplace/actions/display-inputs-action)
- [workflow_dispatch イベント - GitHub Docs](https://docs.github.com/ja/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch)
