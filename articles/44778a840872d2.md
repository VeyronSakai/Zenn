---
title: "ç‰¹å®šã®å·®åˆ†ã‚’ commit ã™ã‚‹ EndBug/add-and-commit ã®ç´¹ä»‹"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [githubactions]
published: false
---

## ã¯ã˜ã‚ã«

ç‰¹å®šã®å·®åˆ†ã‚’ commit ã™ã‚‹ã‚ˆã†ãª GitHub Actions ã® workflow ã® step ã‚’ä½œã‚‹éš›ã«ã€ã“ã‚Œã¾ã§ç§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ•°è¡Œã®ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§å®Ÿè£…ã—ã¦ã„ã¾ã—ãŸã€‚

```yml
- uses: actions/checkout@v4
- name: Confirm diff
  id: confirm-diff
  run: |
    git add "${FILE_PATH}"
    result=0
    git diff --cached --exit-code --quiet || result=$?
    if [ "${result}" -eq 0 ]; then
      echo "diff=false" >> "${GITHUB_OUTPUT}"
    elif [ "${result}" -eq 1 ]; then
      echo "diff=true" >> "${GITHUB_OUTPUT}"
    else
      echo "exit code of diff is unknown: ${result}"
      exit 1
    fi
- name: Commit
  if: ${{ steps.confirm-diff.outputs.diff == 'true' }}
  run: |
    git config user.email github-actions[bot]@users.noreply.github.com
    git config user.name github-actions[bot]
    git switch -C "${SOURCE_BRANCH}"
    git commit -m "Update file"
    git push -u origin "${SOURCE_BRANCH}"
```

ã—ã‹ã—ã€ç‰¹å®šã®å·®åˆ†ã‚’ commit ã—ãŸã„ã‚±ãƒ¼ã‚¹ã¯çµæ§‹ã‚ã‚Šã¾ã™ã€‚ãã®åº¦ã«ä¸Šè¨˜ã®ã‚ˆã†ãªã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã™ã‚‹ã®ã¯ã§ãã‚Œã°é¿ã‘ãŸã„ã‚‚ã®ã§ã™ã€‚

## EndBug/add-and-commit ã¨ã¯

[EndBug/add-and-commit](https://github.com/EndBug/add-and-commit) ã¨ã„ã† action ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ä¸Šè¨˜ã®å®Ÿè£…ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã§ãã¾ã™ã€‚

```yml
- uses: actions/checkout@v4
- name: Commit
  uses: EndBug/add-and-commit@v9
  id: commit
  with:
    author_name: github-actions[bot]
    author_email: github-actions[bot]@users.noreply.github.com
    message: "Update file"
    add: ${{ env.FILE_PATH }}
    new_branch: ${{ env.SOURCE_BRANCH }}
```

:::message
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã¯ git ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ä½¿ç”¨ã•ã‚Œã‚‹ã®ã§ã¯ãªãã€[string-argv](https://www.npmjs.com/package/string-argv) ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã£ã¦è§£æã•ã‚ŒãŸä¸Šã§ [simple-git](https://www.npmjs.com/package/simple-git) ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãã®ãŸã‚ãƒã‚¹ãƒˆã•ã‚ŒãŸå¼•ç”¨ç¬¦ãŒå¤šæ•°å«ã¾ã‚Œã‚‹æ–‡å­—åˆ—ã‚’æ­£ã—ãè§£æã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã®ã“ã¨ã§ã™ã€‚
:::

## çµæœã«å¿œã˜ã¦åˆ¥ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹

EndBug/add-and-commit ã«ã‚ˆã‚Šå®Ÿéš›ã« commit ã‚’è¡Œã£ãŸã‹å¦ã‹ã¯ outputs ã‹ã‚‰å–å¾—å¯èƒ½ã§ã™ã€‚
ãã®ãŸã‚çµæœã«å¿œã˜ãŸå‡¦ç†ã‚’å¾Œç¶šã® step ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ commit ã‚’è¡Œã£ãŸå ´åˆã« PR ã‚’ä½œæˆã—ã¦ãƒãƒ¼ã‚¸ã™ã‚‹ step ã®ä¾‹ã§ã™ã€‚

```yml
- name: Create pull request and merge
  if: ${{ steps.commit.outputs.committed == 'true' }}
  run: |
    gh pr create --title "Update files" --body "Update files" --base main --head "${SOURCE_BRANCH}"
    gh pr merge "${SOURCE_BRANCH}" --auto --merge
```

## å‚è€ƒ

- [EndBug/add-and-commit](https://github.com/EndBug/add-and-commit)
