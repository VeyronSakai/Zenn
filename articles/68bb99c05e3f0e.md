---
title: "UniTask 読解メモ"
emoji: "💬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Unity]
published: false
---

## 概要

[Cysharp/UniTask](https://github.com/Cysharp/UniTask) の内部実装のコードを読んだ際の読解メモです。

## ディレクトリ構成

全体のディレクト構成は以下のようになっています。

```sh
.
├── docs
│   └── api
└── src
    ├── UniTask
    │   ├── Assets
    │   │   ├── Editor
    │   │   ├── Plugins
    │   │   │   └── UniTask
    │   │   │       ├── Editor
    │   │   │       └── Runtime
    │   │   │           ├── CompilerServices
    │   │   │           ├── External
    │   │   │           │   ├── Addressables
    │   │   │           │   ├── DOTween
    │   │   │           │   └── TextMeshPro
    │   │   │           ├── Internal
    │   │   │           ├── Linq
    │   │   │           │   └── UnityExtensions
    │   │   │           └── Triggers
    │   │   ├── RuntimeUnitTestToolkit
    │   │   │   └── Editor
    │   │   ├── Scenes
    │   │   ├── StreamingAssets
    │   │   ├── TempAsm
    │   │   └── Tests
    │   │       ├── Editor
    │   │       └── Resources
    │   ├── ProjectSettings
    │   └── UserSettings
    ├── UniTask.Analyzer
    │   └── Properties
    ├── UniTask.NetCore
    │   └── NetCore
    ├── UniTask.NetCoreSandbox
    └── UniTask.NetCoreTests
        └── Linq

```

UniTask のパッケージ本体は [src/UniTask/Assets/Plugins/UniTask/](https://github.com/Cysharp/UniTask/tree/master/src/UniTask/Assets/Plugins/UniTask) に存在しており、パッケージ本体のみのディレクトリ構成は以下のようになります。

```sh
.
├── Editor
└── Runtime
    ├── CompilerServices
    ├── External
    │   ├── Addressables
    │   ├── DOTween
    │   └── TextMeshPro
    ├── Internal
    ├── Linq
    │   └── UnityExtensions
    └── Triggers
```

本記事ではこのディレクトリにのみ注目し、コードを読解していきます。

## 各 namespace 間の依存関係

登場する namespace は実質的には 5 つのみです[^1]。

- Cysharp.Threading.Tasks
- Cysharp.Threading.Tasks.CompilerServices
- Cysharp.Threading.Tasks.Internal
- Cysharp.Threading.Tasks.Linq
- Cysharp.Threading.Tasks.Triggers

```mermaid
flowchart LR
  Tasks --> Tasks.CompilerServices

  Tasks --> Tasks.Internal --> Tasks.Linq

  Tasks --> Tasks.Triggers
```

[^1]: 厳密には AsyncMethodBuilderAttribute というクラスが System.Runtime.CompilerServices という namepspace に属しています。

## クラス図

## 参考文献

- [UniTaskを使った話](https://hackerslab.aktsk.jp/2019/12/05/124250)

## まとめ
