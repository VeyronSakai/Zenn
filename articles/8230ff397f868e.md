---
title: "Self-hosted Runner ã®ç¨¼åƒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã§ãã‚‹ GitHub CLI æ‹¡å¼µã‚’ä½œã£ãŸ"
emoji: "ğŸ–¥ï¸"
type: "tech"
topics: ["GitHubActions", "GitHubCLI", "Go"]
published: false
---

## ã¯ã˜ã‚ã«

ä»¥å‰ã€[ç‰¹å®šã® Self-hosted Runner ã«çµã£ã¦ Job ã®å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèªã§ãã‚‹ GitHub CLI æ‹¡å¼µã‚’ä½œã£ãŸ](https://zenn.dev/veryon_sakai/articles/6bc9f34595ad01)ã¨ã„ã†è¨˜äº‹ã§ã€[gh-runner-log](https://github.com/VeyronSakai/gh-runner-log) ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚gh-runner-log ã¯ã€Œç‰¹å®šã® Runner ã§éå»ã«ã©ã‚“ãª Job ãŒå®Ÿè¡Œã•ã‚ŒãŸã‹ã€ã‚’ç¢ºèªã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ä¸€æ–¹ã§ã€Self-hosted Runner ã‚’é‹ç”¨ã—ã¦ã„ã‚‹ã¨ã€Œä»Šã€å„ Runner ãŒã©ã‚“ãªçŠ¶æ…‹ã«ã‚ã‚‹ã‹ã€ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡ã—ãŸã„å ´é¢ãŒã‚ã‚Šã¾ã™ã€‚ã©ã® Runner ãŒç¨¼åƒä¸­ã§ã€ã©ã® Runner ãŒã‚¢ã‚¤ãƒ‰ãƒ«çŠ¶æ…‹ãªã®ã‹ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã£ã¦ã„ã‚‹ Runner ã¯ãªã„ã‹ã€‚ã“ã†ã—ãŸæƒ…å ±ã‚’ã‚µãƒƒã¨ç¢ºèªã—ãŸã„ã¨ããŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§ã€Self-hosted Runner ã®ç¨¼åƒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã§ãã‚‹ GitHub CLI æ‹¡å¼µã€Œ**[gh-runner-monitor](https://github.com/VeyronSakai/gh-runner-monitor)**ã€ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## gh-runner-monitor ã¨ã¯

gh-runner-monitor ã¯ã€GitHub Actions ã® Self-hosted Runner ã®ç¨¼åƒçŠ¶æ³ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚TUIï¼ˆTerminal User Interfaceï¼‰ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«æ“ä½œã§ãã¾ã™ã€‚

![gh-runner-monitor ã®å®Ÿè¡Œçµæœ](/images/8230ff397f868e/screenshot.png)

ä¸»ãªæ©Ÿèƒ½ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- ğŸ”„ Runner ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆIdle/Active/Offlineï¼‰ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–
- ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãè¡¨ç¤º
- ğŸ’¼ å®Ÿè¡Œä¸­ã® Job ã¨çµŒéæ™‚é–“ã‚’è¡¨ç¤º
- âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã§ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

GitHub CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
gh extension install VeyronSakai/gh-runner-monitor
```

:::message
èªè¨¼ãŒãŠæ¸ˆã¿ã§ãªã„å ´åˆã¯ã€äº‹å‰ã« `gh auth login` ã§èªè¨¼ã‚’æ¸ˆã¾ã›ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::

## ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªå®Ÿè¡Œæ–¹æ³•

ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒªãƒã‚¸ãƒˆãƒªã«ç´ã¥ã Runner ã‚’ç›£è¦–ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
gh runner-monitor
```

### ç‰¹å®šã®ãƒªãƒã‚¸ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹

`--repo` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ä»»æ„ã®ãƒªãƒã‚¸ãƒˆãƒªã® Runner ã‚’ç›£è¦–ã§ãã¾ã™ã€‚

```bash
gh runner-monitor --repo owner/repo
```

### æ›´æ–°é–“éš”ã‚’å¤‰æ›´ã™ã‚‹

`--interval` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€è‡ªå‹•æ›´æ–°ã®é–“éš”ã‚’ç§’å˜ä½ã§æŒ‡å®šã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 5 ç§’ã§ã™ã€‚

```bash
# 10 ç§’ã”ã¨ã«æ›´æ–°
gh runner-monitor --interval 10
```

## è¡¨ç¤ºå†…å®¹

å®Ÿè¡Œã™ã‚‹ã¨ã€Runner ã®ä¸€è¦§ãŒãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚å„ Runner ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®æƒ…å ±ãŒç¢ºèªã§ãã¾ã™ã€‚

- Runner å
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆIdle/Active/Offlineï¼‰
- OS
- ãƒ©ãƒ™ãƒ«
- å®Ÿè¡Œä¸­ã® Job åã¨çµŒéæ™‚é–“ï¼ˆActive ã®å ´åˆï¼‰

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è‰²åˆ†ã‘

Runner ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è‰²åˆ†ã‘ã•ã‚Œã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

| è‰² | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ„å‘³ |
| --- | --- | --- |
| ğŸŸ¢ ç·‘ | Idle | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§å¾…æ©Ÿä¸­ |
| ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ | Active | Job ã‚’å®Ÿè¡Œä¸­ |
| âš« ã‚°ãƒ¬ãƒ¼ | Offline | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ |

ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè‰²åˆ†ã‘ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è¤‡æ•°ã® Runner ãŒã‚ã£ã¦ã‚‚ä¸€ç›®ã§çŠ¶æ…‹ã‚’æŠŠæ¡ã§ãã¾ã™ã€‚

## ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

gh-runner-monitor ã¯ TUI ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€ä»¥ä¸‹ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãŒå¯èƒ½ã§ã™ã€‚

| ã‚­ãƒ¼ | æ“ä½œ |
| --- | --- |
| `â†‘/â†“` ã¾ãŸã¯ `j/k` | Runner é–“ã®ç§»å‹• |
| `r` | æ‰‹å‹•ã§æ›´æ–° |
| `q` ã¾ãŸã¯ `Ctrl+C` | çµ‚äº† |

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

gh-runner-monitor ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå ´é¢ã§å½¹ç«‹ã¡ã¾ã™ã€‚

- **ç¨¼åƒçŠ¶æ³ã®æŠŠæ¡**: è¤‡æ•°ã® Runner ãŒã©ã®ã‚ˆã†ãªçŠ¶æ…‹ã«ã‚ã‚‹ã‹ã‚’ä¸€ç›®ã§ç¢ºèªã—ãŸã„ã¨ã
- **éšœå®³æ¤œçŸ¥**: Runner ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã£ã¦ã„ãªã„ã‹ç´ æ—©ããƒã‚§ãƒƒã‚¯ã—ãŸã„ã¨ã
- **è² è·ã®ç¢ºèª**: ã©ã® Runner ãŒå¿™ã—ãã€ã©ã® Runner ãŒã‚¢ã‚¤ãƒ‰ãƒ«çŠ¶æ…‹ã‹ã‚’æŠŠæ¡ã—ãŸã„ã¨ã
- **å®Ÿè¡Œæ™‚é–“ã®ç›£è¦–**: Job ã®å®Ÿè¡Œæ™‚é–“ãŒæƒ³å®šã‚ˆã‚Šé•·ããªã£ã¦ã„ãªã„ã‹ç¢ºèªã—ãŸã„ã¨ã

## å†…éƒ¨å®Ÿè£…

gh-runner-monitor ã®å†…éƒ¨å®Ÿè£…ã«ã¤ã„ã¦ç°¡å˜ã«è§£èª¬ã—ã¾ã™ã€‚

### ä½¿ç”¨ã—ã¦ã„ã‚‹ GitHub API

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ä¸»ã«ä»¥ä¸‹ã® GitHub REST API ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

| API | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | å–å¾—ã™ã‚‹æƒ…å ± |
| --- | --- | --- |
| List self-hosted runners | `GET /repos/{owner}/{repo}/actions/runners` | Runner ã® IDã€åå‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€OSã€ãƒ©ãƒ™ãƒ« |
| List workflow runs | `GET /repos/{owner}/{repo}/actions/runs?status={status}` | å®Ÿè¡Œä¸­ï¼ˆin_progressï¼‰ãŠã‚ˆã³å¾…æ©Ÿä¸­ï¼ˆqueuedï¼‰ã® Workflow run ä¸€è¦§ |
| List jobs for a workflow run | `GET /repos/{owner}/{repo}/actions/runs/{run_id}/jobs` | å„ Workflow run ã«å«ã¾ã‚Œã‚‹ Job ã®è©³ç´° |

### ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æµã‚Œ

```mermaid
sequenceDiagram
    participant CLI as gh-runner-monitor
    participant Runners as Runners API
    participant Runs as Workflow Runs API
    participant Jobs as Jobs API

    CLI->>Runners: 1. Runner ä¸€è¦§ã‚’å–å¾—
    Runners-->>CLI: Runner æƒ…å ±ï¼ˆID, ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, busy ç­‰ï¼‰

    CLI->>Runs: 2. in_progress ã® Workflow run ã‚’å–å¾—
    Runs-->>CLI: å®Ÿè¡Œä¸­ã® Workflow run ä¸€è¦§

    CLI->>Runs: 3. queued ã® Workflow run ã‚’å–å¾—
    Runs-->>CLI: å¾…æ©Ÿä¸­ã® Workflow run ä¸€è¦§

    loop å„ Workflow run ã«å¯¾ã—ã¦
        CLI->>Jobs: 4. Job ä¸€è¦§ã‚’å–å¾—
        Jobs-->>CLI: Job ä¸€è¦§ï¼ˆrunner_id ã‚’å«ã‚€ï¼‰
    end

    Note over CLI: 5. Runner ã¨ Job ã‚’çªãåˆã‚ã›ã¦è¡¨ç¤º
```

1. **Runner ä¸€è¦§ã®å–å¾—**: List self-hosted runners API ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã«ç´ã¥ãã™ã¹ã¦ã® Runner ã‚’å–å¾—ã™ã‚‹ã€‚å„ Runner ã® `status`ï¼ˆonline/offlineï¼‰ã¨ `busy`ï¼ˆtrue/falseï¼‰ã‹ã‚‰ã€Idle/Active/Offline ã‚’åˆ¤å®šã™ã‚‹ã€‚
2. **å®Ÿè¡Œä¸­ã® Job ã®å–å¾—**: List workflow runs API ã§ã€`status=in_progress` ã¨ `status=queued` ã® Workflow run ã‚’å–å¾—ã™ã‚‹ã€‚
3. **Job ã®è©³ç´°å–å¾—**: å„ Workflow run ã«å¯¾ã—ã¦ List jobs API ã‚’å‘¼ã³å‡ºã—ã€å®Ÿè¡Œä¸­ã® Job ã¨æ‹…å½“ Runner ã‚’ç‰¹å®šã™ã‚‹ã€‚
4. **ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ**: Runner æƒ…å ±ã¨ Job æƒ…å ±ã‚’çªãåˆã‚ã›ã€ã©ã® Runner ãŒã©ã® Job ã‚’å®Ÿè¡Œä¸­ã‹ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

:::message alert
**API Rate Limit ã«é–¢ã™ã‚‹æ³¨æ„**

gh-runner-monitor ã¯å®šæœŸçš„ã« GitHub API ã‚’å‘¼ã³å‡ºã™ãŸã‚ã€æ›´æ–°é–“éš”ãŒçŸ­ã„ã¨ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã«é”ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã«é”ã—ã¦ã—ã¾ã†å ´åˆã¯ã€`--interval` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ›´æ–°é–“éš”ã‚’é•·ã‚ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚

```bash
# 30 ç§’ã”ã¨ã«æ›´æ–°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 5 ç§’ï¼‰
gh runner-monitor --interval 30
```

:::

## gh-runner-log ã¨ã®ä½¿ã„åˆ†ã‘

ä»¥å‰ç´¹ä»‹ã—ãŸ [gh-runner-log](https://github.com/VeyronSakai/gh-runner-log) ã¨ [gh-runner-monitor](https://github.com/VeyronSakai/gh-runner-monitor) ã¯ã€ãã‚Œãã‚Œç•°ãªã‚‹ç”¨é€”ã«é©ã—ã¦ã„ã¾ã™ã€‚

| ãƒ„ãƒ¼ãƒ« | ç”¨é€” | ç¢ºèªã§ãã‚‹æƒ…å ± |
| --- | --- | --- |
| gh-runner-log | äº‹å¾Œåˆ†æ | ç‰¹å®š Runner ã®**éå»**ã® Job å±¥æ­´ |
| gh-runner-monitor | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦– | è¤‡æ•° Runner ã®**ç¾åœ¨**ã®ç¨¼åƒçŠ¶æ³ |

ã€Œéå»ã«ä½•ãŒèµ·ããŸã‹ã€ã‚’èª¿ã¹ã‚‹ãªã‚‰ gh-runner-logã€ã€Œä»Šã©ã†ãªã£ã¦ã„ã‚‹ã‹ã€ã‚’çŸ¥ã‚ŠãŸã„ãªã‚‰ gh-runner-monitor ã‚’ä½¿ã„ã¾ã™ã€‚ä¸¡æ–¹ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€Self-hosted Runner ã‚’ã‚ˆã‚ŠåŠ¹ç‡çš„ã«é‹ç”¨ã§ãã¾ã™ã€‚

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€Self-hosted Runner ã®ç¨¼åƒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã§ãã‚‹ GitHub CLI æ‹¡å¼µ gh-runner-monitor ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

- TUI ã§ Runner ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç›´æ„Ÿçš„ã«ç¢ºèªã§ãã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè‰²åˆ†ã‘ã•ã‚Œã‚‹ãŸã‚ã€ä¸€ç›®ã§çŠ¶æ…‹ã‚’æŠŠæ¡ã§ãã‚‹
- [gh-runner-log](https://github.com/VeyronSakai/gh-runner-log) ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€éå»ã¨ç¾åœ¨ã®ä¸¡æ–¹ã‚’æŠŠæ¡ã§ãã‚‹

Self-hosted Runner ã‚’é‹ç”¨ã—ã¦ã„ã‚‹æ–¹ã¯ã€ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚„ä¸å…·åˆå ±å‘Šã¯ [Issues](https://github.com/VeyronSakai/gh-runner-monitor/issues) ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚

## å‚è€ƒ

- [VeyronSakai/gh-runner-monitor](https://github.com/VeyronSakai/gh-runner-monitor)
- [ç‰¹å®šã® Self-hosted Runner ã«çµã£ã¦ Job ã®å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèªã§ãã‚‹ GitHub CLI æ‹¡å¼µã‚’ä½œã£ãŸ](https://zenn.dev/veryon_sakai/articles/6bc9f34595ad01)
- [GitHub CLI](https://cli.github.com/)
